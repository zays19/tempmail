<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Temporary Mail</title>

<style>
body{
    background:#070f1e;
    color:white;
    font-family:Arial;
    text-align:center;
}

.box{
    background:#0f1627;
    margin:20px;
    padding:20px;
    border-radius:14px;
}

.email, .otp{
    background:#0b1220;
    padding:14px;
    margin-top:10px;
    border-radius:10px;
    cursor:pointer;
    user-select:none;
}

button{
    background:#3b82f6;
    border:none;
    padding:12px 20px;
    color:white;
    border-radius:10px;
    margin-top:15px;
}

.refresh{
    cursor:pointer;
    font-size:20px;
    margin-left:10px;
}
</style>
</head>

<body>

<h1>Temporary Mail</h1>

<div class="box">
<h2>Single Email</h2>

<div id="email" class="email">Klik Generate</div>
<div id="otp" class="otp">Menunggu OTP...</div>

<button onclick="generate()">Generate Email</button>
<span class="refresh" onclick="check()">⟳</span>
</div>

<script>

let currentEmail=null
let currentToken=null
let loop=null

function copy(el){
    navigator.clipboard.writeText(el.innerText)
    el.innerText="✓ Copied"
    setTimeout(()=>{el.innerText=currentEmail},900)
}

document.getElementById("email").onclick=()=>{if(currentEmail) copy(document.getElementById("email"))}
document.getElementById("otp").onclick=()=>copy(document.getElementById("otp"))

async function generate(){

    document.getElementById("email").innerText="Generating..."

    // MINTA EMAIL LANGSUNG KE TEMPMAIL
    const res = await fetch("https://temp-mail.app/api/email/new", {
        credentials:"include"
    })

    const data = await res.json()

    currentEmail = data.mailbox + "@" + data.domain
    currentToken = data.token

    document.getElementById("email").innerText=currentEmail
    document.getElementById("otp").innerText="Menunggu OTP..."

    if(loop) clearInterval(loop)
    loop=setInterval(check,5000)
}

async function check(){
    if(!currentToken) return

    const res = await fetch(`https://temp-mail.app/api/mail/list?token=${currentToken}`)
    const data = await res.json()

    if(data.length>0){
        const mail = data[0]
        const body = (mail.body || "") + (mail.text || "")
        const match = body.match(/\b\d{4,8}\b/)

        if(match){
            document.getElementById("otp").innerText=match[0]
        }
    }
}

</script>

</body>
</html>
