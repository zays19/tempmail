<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Temporary Mail</title>

<style>
body{
    background:#070f1e;
    color:white;
    font-family:Arial;
    text-align:center;
}

.box{
    background:#0f1627;
    margin:20px;
    padding:20px;
    border-radius:14px;
}

.email, .otp{
    background:#0b1220;
    padding:14px;
    margin-top:10px;
    border-radius:10px;
    cursor:pointer;
    user-select:none;
    transition:0.2s;
}

.email:hover,.otp:hover{
    background:#17223a;
}

button{
    background:#3b82f6;
    border:none;
    padding:12px 20px;
    color:white;
    border-radius:10px;
    margin-top:15px;
}

.refresh{
    cursor:pointer;
    font-size:20px;
    margin-left:10px;
}
</style>
</head>

<body>

<h1>Temporary Mail</h1>

<div class="box">
<h2>Single Email</h2>

<div id="email" class="email">Klik Generate</div>
<div id="otp" class="otp">Menunggu OTP...</div>

<button onclick="generate()">Generate Email</button>
<span class="refresh" onclick="check()">⟳</span>

</div>

<div class="box">
<h2>Bulk Mode (5 Email)</h2>
<div id="bulk"></div>
<button onclick="bulk()">Generate 5 Email</button>
</div>

<script>

let currentEmail = null
let currentToken = null
let loop = null

function copyText(text, element){
    navigator.clipboard.writeText(text)
    const old = element.innerText
    element.innerText = "✓ Copied"
    element.style.background="#16a34a"

    setTimeout(()=>{
        element.innerText = old
        element.style.background="#0b1220"
    },900)
}

document.getElementById("email").onclick=()=>{
    if(currentEmail) copyText(currentEmail, document.getElementById("email"))
}

document.getElementById("otp").onclick=()=>{
    const otp = document.getElementById("otp").innerText
    if(otp!="Menunggu OTP..." && otp!="Klik Generate"){
        copyText(otp, document.getElementById("otp"))
    }
}

async function generate(){
    document.getElementById("email").innerText="Generating..."
    document.getElementById("otp").innerText="Menunggu OTP..."

    const res = await fetch("/generate")
    const data = await res.json()

    currentEmail = data.email
    currentToken = data.token

    document.getElementById("email").innerText=currentEmail

    if(loop) clearInterval(loop)
    loop = setInterval(check,5000)
}

async function check(){
    if(!currentToken) return

    const res = await fetch(`/check?token=${currentToken}`)
    const data = await res.json()

    if(data.otp){
        document.getElementById("otp").innerText=data.otp
    }
}

async function bulk(){
    document.getElementById("bulk").innerHTML="Generating..."

    const res = await fetch("/bulk")
    const data = await res.json()

    let html=""
    data.forEach(e=>{
        html+=`<div class="email" onclick="navigator.clipboard.writeText('${e}')">${e}</div>`
    })

    document.getElementById("bulk").innerHTML=html
}

</script>

</body>
</html>
